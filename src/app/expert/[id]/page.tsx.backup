'use client'

import { useState, useEffect } from 'react'
import { useParams, useRouter } from 'next/navigation'
import Link from 'next/link'
import { Header } from '@/components/layout/header'
import { Button } from '@/components/ui/button'
import { Card } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Separator } from '@/components/ui/separator'
import ProveeAPI from '@/lib/api'
import { EnhancedProveeAPI } from '@/lib/api-enhanced'
import {
  Star,
  MapPin,
  Clock,
  Shield,
  Award,
  Phone,
  MessageSquare,
  Heart,
  Share2,
  Camera,
  Users,
  Calendar,
  DollarSign,
  CheckCircle,
  ArrowLeft,
  ChevronLeft,
  ChevronRight,
  ExternalLink
} from 'lucide-react'

interface ExpertProfile {
  id: string
  category?: string[]
  services: string[]
  location: string
  description: string | null
  price_min: number
  price_max: number
  rating: number | null
  review_count: number | null
  completed_projects: number | null
  experience_years: number | null
  response_time_hours: number | null
  verified: boolean | null
  is_available: boolean | null
  portfolio_images: string[] | null
  hourly_rate: number | null
  // Enhanced data
  certifications?: any[]
  faqs?: any[]
  portfolio?: any[]
  service_areas?: any[]
  reviews?: any[]
  work_process?: any[]
}

interface Review {
  id: string
  rating: number
  comment: string
  author: string
  date: string
  service: string
}

export default function ExpertDetailPage() {
  const params = useParams()
  const router = useRouter()
  const expertId = params.id as string

  const [expert, setExpert] = useState<ExpertProfile | null>(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)
  const [selectedImageIndex, setSelectedImageIndex] = useState(0)
  const [showAllImages, setShowAllImages] = useState(false)

  // Get data from expert object
  const reviews = expert?.reviews || []
  const portfolioImages = expert?.portfolio || expert?.portfolio_images || []
  const certifications = expert?.certifications || []
  const faqs = expert?.faqs || []
  const serviceAreas = expert?.service_areas || []
  const workProcess = expert?.work_process || []

  useEffect(() => {
    const fetchExpert = async () => {
      try {
        setLoading(true)
        const response = await EnhancedProveeAPI.getExpertDetails(expertId)
        if (response.success && response.data) {
          setExpert(response.data)
        } else {
          setError(response.error || '전문가 정보를 불러올 수 없습니다.')
        }
      } catch (err) {
        setError('전문가 정보를 불러오는 중 오류가 발생했습니다.')
      } finally {
        setLoading(false)
      }
    }

    if (expertId) {
      fetchExpert()
    }
  }, [expertId])

  const handleContact = () => {
    alert('연락하기 기능이 구현됩니다.')
  }

  const handleRequestQuote = () => {
    router.push(`/request?expert=${expertId}`)
  }

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50">
        <Header />
        <div className="max-w-7xl mx-auto px-4 py-8">
          <div className="text-center">
            <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <p className="mt-2 text-gray-600">전문가 정보를 불러오는 중...</p>
          </div>
        </div>
      </div>
    )
  }

  if (error || !expert) {
    return (
      <div className="min-h-screen bg-gray-50">
        <Header />
        <div className="max-w-7xl mx-auto px-4 py-8">
          <div className="text-center">
            <p className="text-red-600 mb-4">{error}</p>
            <Button onClick={() => router.back()} variant="outline">
              <ArrowLeft className="w-4 h-4 mr-2" />
              돌아가기
            </Button>
          </div>
        </div>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <Header />

      {/* Breadcrumb */}
      <div className="bg-white border-b">
        <div className="max-w-7xl mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <button onClick={() => router.push('/')} className="hover:text-blue-600">
              홈
            </button>
            <span>/</span>
            <button onClick={() => router.push('/search')} className="hover:text-blue-600">
              전문가 찾기
            </button>
            <span>/</span>
            <span className="text-gray-900">전문가 #{expert.id}</span>
          </div>
        </div>
      </div>

      <div className="max-w-7xl mx-auto px-4 py-8">

        <div className="grid lg:grid-cols-3 gap-8">
          {/* Main Content */}
          <div className="lg:col-span-2 space-y-8">
            {/* Expert Header */}
            <Card className="p-8">
              <div className="flex items-start space-x-6">
                <div className="flex-shrink-0">
                  <div className="w-24 h-24 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center">
                    <Users className="w-12 h-12 text-white" />
                  </div>
                </div>

                <div className="flex-1 min-w-0">
                  <div className="flex items-center justify-between mb-4">
                    <div>
                      <h1 className="text-3xl font-bold text-gray-900 mb-2">
                        전문가 #{expert.id}
                        {expert.verified && (
                          <Shield className="inline w-6 h-6 text-blue-500 ml-2" />
                        )}
                      </h1>
                      <div className="flex items-center space-x-4 text-gray-600">
                        <div className="flex items-center">
                          <MapPin className="w-4 h-4 mr-1" />
                          {expert.location}
                        </div>
                        <div className="flex items-center">
                          <Clock className="w-4 h-4 mr-1" />
                          {expert.response_time_hours ? `${expert.response_time_hours}시간 내 응답` : '응답시간 미상'}
                        </div>
                      </div>
                    </div>

                    <div className="flex space-x-2">
                      <Button variant="ghost" size="sm">
                        <Heart className="w-5 h-5" />
                      </Button>
                      <Button variant="ghost" size="sm">
                        <Share2 className="w-5 h-5" />
                      </Button>
                    </div>
                  </div>

                  {/* Rating & Reviews */}
                  <div className="flex items-center space-x-6 mb-4">
                    <div className="flex items-center">
                      <div className="flex space-x-1">
                        {[1, 2, 3, 4, 5].map((star) => (
                          <Star
                            key={star}
                            className={`w-5 h-5 ${
                              star <= (expert.rating || 0)
                                ? 'text-yellow-400 fill-current'
                                : 'text-gray-300'
                            }`}
                          />
                        ))}
                      </div>
                      <span className="ml-2 text-lg font-semibold">
                        {expert.rating || 0}
                      </span>
                      <span className="ml-1 text-gray-600">
                        ({expert.review_count || 0}개 리뷰)
                      </span>
                    </div>

                    <div className="text-sm text-gray-600">
                      완료 프로젝트 {expert.completed_projects || 0}건
                    </div>
                  </div>

                  {/* Services */}
                  <div className="flex flex-wrap gap-2 mb-6">
                    {expert.services.map((service, index) => (
                      <Badge key={index} variant="secondary" className="bg-blue-100 text-blue-800">
                        {service}
                      </Badge>
                    ))}
                    {expert.is_available && (
                      <Badge className="bg-green-100 text-green-800">
                        즉시 연락 가능
                      </Badge>
                    )}
                  </div>

                  {/* Price */}
                  <div className="text-lg">
                    <span className="text-gray-600">예상 비용: </span>
                    <span className="font-semibold text-gray-900">
                      {expert.price_min.toLocaleString()}원 - {expert.price_max.toLocaleString()}원
                    </span>
                  </div>
                </div>
              </div>
            </Card>

            {/* Expert Statistics */}
            <Card className="p-8">
              <h2 className="text-2xl font-semibold mb-6">전문가 정보</h2>
              <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div className="text-center p-4 bg-gray-50 rounded-lg">
                  <div className="text-3xl font-bold text-blue-600 mb-2">
                    {expert.experience_years || 0}년
                  </div>
                  <div className="text-sm text-gray-600">경력</div>
                </div>
                <div className="text-center p-4 bg-gray-50 rounded-lg">
                  <div className="text-3xl font-bold text-green-600 mb-2">
                    {expert.completed_projects || 0}건
                  </div>
                  <div className="text-sm text-gray-600">총 완료 프로젝트</div>
                </div>
                <div className="text-center p-4 bg-gray-50 rounded-lg">
                  <div className="text-3xl font-bold text-purple-600 mb-2">
                    {expert.review_count || 0}개
                  </div>
                  <div className="text-sm text-gray-600">총 리뷰 수</div>
                </div>
                <div className="text-center p-4 bg-gray-50 rounded-lg">
                  <div className="text-3xl font-bold text-orange-600 mb-2">
                    {expert.response_time_hours || 0}시간
                  </div>
                  <div className="text-sm text-gray-600">평균 응답시간</div>
                </div>
              </div>
            </Card>

            {/* Description */}
            <Card className="p-8">
              <h2 className="text-2xl font-semibold mb-4">소개</h2>
              <p className="text-gray-700 leading-relaxed whitespace-pre-line">
                {expert.description || '소개글이 없습니다.'}
              </p>

              {expert.experience_years && (
                <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                  <div className="flex items-center">
                    <Award className="w-5 h-5 text-blue-600 mr-2" />
                    <span className="font-medium text-blue-900">
                      경력 {expert.experience_years}년의 전문가입니다
                    </span>
                  </div>
                </div>
              )}
            </Card>

            {/* Service Details & Pricing */}
            <Card className="p-8">
              <h2 className="text-2xl font-semibold mb-6">제공 서비스 및 요금</h2>
              <div className="space-y-6">
                {expert.services.map((service, index) => (
                  <div key={index} className="border border-gray-200 rounded-lg p-6">
                    <div className="flex justify-between items-start mb-4">
                      <div>
                        <h3 className="text-xl font-semibold text-gray-900 mb-2">{service}</h3>
                        <p className="text-gray-600">
                          {service === '홈클리닝' && '가정집 전체 청소 서비스 (거실, 주방, 화장실, 침실 포함)'}
                          {service === '사무실청소' && '사무실 및 상업공간 청소 서비스'}
                          {service === '입주청소' && '이사 전 또는 이사 후 전체 청소 서비스'}
                          {service === '가전수리' && '에어컨, 세탁기, 냉장고 등 가전제품 수리'}
                          {service === '가구수리' && '책상, 의자, 침대 등 가구 수리 및 조립'}
                          {service === '영어과외' && '개인별 맞춤 영어 교육 (회화, 문법, 시험 대비)'}
                          {service === '수학과외' && '초중고 수학 개인 교육 및 입시 대비'}
                          {service === '로고디자인' && '브랜드 로고 및 아이덴티티 디자인'}
                          {service === '웹디자인' && '웹사이트 UI/UX 디자인 및 퍼블리싱'}
                        </p>
                      </div>
                      <div className="text-right">
                        <div className="text-2xl font-bold text-blue-600">
                          {Math.floor((expert.price_min + expert.price_max) / 2).toLocaleString()}원
                        </div>
                        <div className="text-sm text-gray-500">평균 요금</div>
                      </div>
                    </div>

                    <div className="flex items-center justify-between text-sm text-gray-600">
                      <div className="flex items-center">
                        <Clock className="w-4 h-4 mr-1" />
                        <span>소요시간: 2-4시간</span>
                      </div>
                      <div className="flex items-center">
                        <DollarSign className="w-4 h-4 mr-1" />
                        <span>{expert.price_min.toLocaleString()}원 - {expert.price_max.toLocaleString()}원</span>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </Card>

            {/* Work Process */}
            <Card className="p-8">
              <h2 className="text-2xl font-semibold mb-6">작업 프로세스</h2>
              <div className="space-y-6">
                {workProcess.length > 0 ? workProcess.map((process, index) => {
                  const categoryColors = {
                    '청소': { bg: 'bg-blue-100', text: 'bg-blue-600' },
                    '수리': { bg: 'bg-orange-100', text: 'bg-orange-600' },
                    '과외': { bg: 'bg-green-100', text: 'bg-green-600' },
                    '디자인': { bg: 'bg-purple-100', text: 'bg-purple-600' }
                  }
                  const colors = categoryColors[expert.category?.[0] as keyof typeof categoryColors] || { bg: 'bg-gray-100', text: 'bg-gray-600' }

                  return (
                    <div key={index} className="flex items-start space-x-4">
                      <div className={`flex-shrink-0 w-12 h-12 ${colors.bg} rounded-full flex items-center justify-center`}>
                        <span className="text-2xl">{process.icon}</span>
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center mb-2">
                          <span className={`${colors.text} text-white text-sm font-medium px-3 py-1 rounded-full mr-3`}>
                            {process.step}단계
                          </span>
                          <h3 className="text-lg font-semibold text-gray-900">{process.title}</h3>
                        </div>
                        <p className="text-gray-600">{process.description}</p>
                      </div>
                    </div>
                  )
                }) : (
                  <div className="text-center text-gray-500 py-8">
                    작업 프로세스 정보가 없습니다.
                  </div>
                )}
              </div>
            </Card>

            {/* Portfolio/Gallery */}
            <Card className="p-8">
              <h2 className="text-2xl font-semibold mb-6">포트폴리오</h2>

              {/* Before/After Section for cleaning */}
              {expert.category?.[0] === '청소' && (
                <div className="mb-8">
                  <h3 className="text-lg font-medium mb-4">청소 전후 비교</h3>
                  <div className="grid md:grid-cols-2 gap-6">
                    <div className="space-y-4">
                      <div className="relative">
                        <div className="aspect-video bg-gray-200 rounded-lg overflow-hidden">
                          <div className="w-full h-full flex items-center justify-center">
                            <Camera className="w-8 h-8 text-gray-400" />
                          </div>
                        </div>
                        <div className="absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded">
                          청소 전
                        </div>
                      </div>
                      <div className="relative">
                        <div className="aspect-video bg-gray-200 rounded-lg overflow-hidden">
                          <div className="w-full h-full flex items-center justify-center">
                            <Camera className="w-8 h-8 text-gray-400" />
                          </div>
                        </div>
                        <div className="absolute top-2 left-2 bg-green-500 text-white text-xs px-2 py-1 rounded">
                          청소 후
                        </div>
                      </div>
                    </div>
                    <div className="space-y-4">
                      <div className="relative">
                        <div className="aspect-video bg-gray-200 rounded-lg overflow-hidden">
                          <div className="w-full h-full flex items-center justify-center">
                            <Camera className="w-8 h-8 text-gray-400" />
                          </div>
                        </div>
                        <div className="absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded">
                          청소 전
                        </div>
                      </div>
                      <div className="relative">
                        <div className="aspect-video bg-gray-200 rounded-lg overflow-hidden">
                          <div className="w-full h-full flex items-center justify-center">
                            <Camera className="w-8 h-8 text-gray-400" />
                          </div>
                        </div>
                        <div className="absolute top-2 left-2 bg-green-500 text-white text-xs px-2 py-1 rounded">
                          청소 후
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* Before/After Section for repair */}
              {expert.category?.[0] === '수리' && (
                <div className="mb-8">
                  <h3 className="text-lg font-medium mb-4">수리 전후 비교</h3>
                  <div className="grid md:grid-cols-2 gap-6">
                    <div className="space-y-4">
                      <div className="relative">
                        <div className="aspect-video bg-gray-200 rounded-lg overflow-hidden">
                          <div className="w-full h-full flex items-center justify-center">
                            <Camera className="w-8 h-8 text-gray-400" />
                          </div>
                        </div>
                        <div className="absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded">
                          수리 전
                        </div>
                      </div>
                      <div className="relative">
                        <div className="aspect-video bg-gray-200 rounded-lg overflow-hidden">
                          <div className="w-full h-full flex items-center justify-center">
                            <Camera className="w-8 h-8 text-gray-400" />
                          </div>
                        </div>
                        <div className="absolute top-2 left-2 bg-green-500 text-white text-xs px-2 py-1 rounded">
                          수리 후
                        </div>
                      </div>
                    </div>
                    <div className="space-y-4">
                      <div className="relative">
                        <div className="aspect-video bg-gray-200 rounded-lg overflow-hidden">
                          <div className="w-full h-full flex items-center justify-center">
                            <Camera className="w-8 h-8 text-gray-400" />
                          </div>
                        </div>
                        <div className="absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded">
                          수리 전
                        </div>
                      </div>
                      <div className="relative">
                        <div className="aspect-video bg-gray-200 rounded-lg overflow-hidden">
                          <div className="w-full h-full flex items-center justify-center">
                            <Camera className="w-8 h-8 text-gray-400" />
                          </div>
                        </div>
                        <div className="absolute top-2 left-2 bg-green-500 text-white text-xs px-2 py-1 rounded">
                          수리 후
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* Design Portfolio for designers */}
              {expert.category?.[0] === '디자인' && (
                <div className="mb-8">
                  <h3 className="text-lg font-medium mb-4">최근 작업물</h3>
                  <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                    {[1, 2, 3, 4, 5, 6].map((item, index) => (
                      <div key={index} className="space-y-2">
                        <div className="aspect-square bg-gray-200 rounded-lg overflow-hidden">
                          <div className="w-full h-full flex items-center justify-center">
                            <Camera className="w-8 h-8 text-gray-400" />
                          </div>
                        </div>
                        <div className="text-sm text-gray-600">
                          {index < 2 ? '로고 디자인' : index < 4 ? '웹사이트 디자인' : 'UI/UX 디자인'}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* General Portfolio Grid */}
              <div>
                <h3 className="text-lg font-medium mb-4">
                  {expert.category?.[0] === '과외' ? '수업 자료 & 성과' : '추가 작업 사진'}
                </h3>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                  {portfolioImages.slice(0, showAllImages ? portfolioImages.length : 6).map((image, index) => (
                    <div
                      key={index}
                      className="aspect-video bg-gray-200 rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity"
                      onClick={() => setSelectedImageIndex(index)}
                    >
                      <div className="w-full h-full flex items-center justify-center">
                        <Camera className="w-8 h-8 text-gray-400" />
                      </div>
                    </div>
                  ))}
                </div>

                {portfolioImages.length > 6 && !showAllImages && (
                  <div className="text-center mt-4">
                    <Button
                      variant="outline"
                      onClick={() => setShowAllImages(true)}
                    >
                      더 많은 사진 보기 (+{portfolioImages.length - 6})
                    </Button>
                  </div>
                )}
              </div>
            </Card>

            {/* Certifications & Verifications */}
            <Card className="p-8">
              <h2 className="text-2xl font-semibold mb-6">인증 및 자격</h2>
              <div className="grid md:grid-cols-2 gap-6">
                <div className="space-y-4">
                  <h3 className="text-lg font-medium text-gray-900 mb-4">보유 자격증</h3>
                  {certifications.filter(cert => cert.type === 'professional').length > 0 ? (
                    <div className="space-y-3">
                      {certifications.filter(cert => cert.type === 'professional').map((cert, index) => (
                        <div key={index} className="flex items-center p-3 bg-blue-50 border border-blue-200 rounded-lg">
                          <CheckCircle className="w-5 h-5 text-blue-600 mr-3" />
                          <div>
                            <span className="text-blue-800 font-medium">{cert.name}</span>
                            {cert.issuer && <div className="text-xs text-blue-600 mt-1">{cert.issuer}</div>}
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <div className="text-gray-500 text-sm">등록된 자격증이 없습니다.</div>
                  )}
                </div>

                <div className="space-y-4">
                  <h3 className="text-lg font-medium text-gray-900 mb-4">플랫폼 인증</h3>
                  <div className="space-y-3">
                    {certifications.filter(cert => cert.type === 'platform').map((cert, index) => (
                      <div key={index} className="flex items-center p-3 bg-green-50 border border-green-200 rounded-lg">
                        <Shield className="w-5 h-5 text-green-600 mr-3" />
                        <span className="text-green-800">{cert.name}</span>
                      </div>
                    ))}

                    {expert.verified && (
                      <div className="flex items-center p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <CheckCircle className="w-5 h-5 text-blue-600 mr-3" />
                        <span className="text-blue-800">전화번호 인증 완료</span>
                      </div>
                    )}

                    {expert.rating && expert.rating >= 4.5 && (
                      <div className="flex items-center p-3 bg-purple-50 border border-purple-200 rounded-lg">
                        <Award className="w-5 h-5 text-purple-600 mr-3" />
                        <span className="text-purple-800">고객 만족도 {expert.rating}점 이상</span>
                      </div>
                    )}

                    {expert.rating && expert.rating >= 4.7 && (
                      <div className="flex items-center p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <Star className="w-5 h-5 text-yellow-600 mr-3" />
                        <span className="text-yellow-800">우수 전문가 등급</span>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </Card>

            {/* FAQ Section */}
            <Card className="p-8">
              <h2 className="text-2xl font-semibold mb-6">자주 묻는 질문</h2>
              <div className="space-y-4">
                {faqs.length > 0 ? faqs.map((faq, index) => (
                  <div key={index} className="border border-gray-200 rounded-lg p-4">
                    <div className="font-semibold text-gray-900 mb-2">Q. {faq.question}</div>
                    <div className="text-gray-600">A. {faq.answer}</div>
                  </div>
                )) : (
                  <div className="text-center text-gray-500 py-8">
                    아직 등록된 FAQ가 없습니다.
                  </div>
                )}
              </div>
            </Card>

            {/* Reviews */}
            <Card className="p-8">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-2xl font-semibold">리뷰</h2>
                <div className="text-sm text-gray-600">
                  총 {reviews.length}개의 리뷰
                </div>
              </div>

              <div className="space-y-6">
                {reviews.map((review) => (
                  <div key={review.id} className="border-b border-gray-200 pb-6 last:border-0">
                    <div className="flex items-start justify-between mb-2">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center">
                          <Users className="w-5 h-5 text-gray-400" />
                        </div>
                        <div>
                          <p className="font-medium text-gray-900">{review.author || '익명'}</p>
                          <p className="text-sm text-gray-600">{review.service_type} • {review.date}</p>
                        </div>
                      </div>

                      <div className="flex items-center">
                        {[1, 2, 3, 4, 5].map((star) => (
                          <Star
                            key={star}
                            className={`w-4 h-4 ${
                              star <= review.rating
                                ? 'text-yellow-400 fill-current'
                                : 'text-gray-300'
                            }`}
                          />
                        ))}
                      </div>
                    </div>

                    <p className="text-gray-700 ml-13">
                      {review.comment}
                    </p>
                  </div>
                ))}
              </div>

              <div className="text-center mt-6">
                <Button variant="outline">
                  더 많은 리뷰 보기
                </Button>
              </div>
            </Card>

            {/* Location & Service Area */}
            <Card className="p-8">
              <h2 className="text-2xl font-semibold mb-6">서비스 지역</h2>
              <div className="grid md:grid-cols-2 gap-6">
                <div>
                  <h3 className="text-lg font-medium text-gray-900 mb-4">기본 서비스 지역</h3>
                  <div className="space-y-2">
                    {serviceAreas.filter(area => area.is_primary).map((area, index) => (
                      <div key={index}>
                        <div className="flex items-center p-3 bg-blue-50 border border-blue-200 rounded-lg">
                          <MapPin className="w-5 h-5 text-blue-600 mr-3" />
                          <span className="text-blue-800">{area.area_name}</span>
                        </div>
                        <div className="text-sm text-gray-600 ml-8">
                          출장비 무료 • 평균 이동시간 {area.travel_time_minutes}분
                        </div>
                      </div>
                    ))}
                    {serviceAreas.filter(area => area.is_primary).length === 0 && (
                      <div className="flex items-center p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <MapPin className="w-5 h-5 text-blue-600 mr-3" />
                        <span className="text-blue-800">{expert.location}</span>
                      </div>
                    )}
                  </div>
                </div>

                <div>
                  <h3 className="text-lg font-medium text-gray-900 mb-4">추가 서비스 가능 지역</h3>
                  <div className="space-y-2">
                    {serviceAreas.filter(area => !area.is_primary).length > 0 ? serviceAreas.filter(area => !area.is_primary).map((area, index) => (
                      <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div className="flex items-center">
                          <MapPin className="w-4 h-4 text-gray-500 mr-2" />
                          <span className="text-gray-700">{area.area_name}</span>
                        </div>
                        <div className="text-sm text-gray-500">
                          출장비 {area.travel_fee.toLocaleString()}원 • {area.travel_time_minutes}분
                        </div>
                      </div>
                    )) : (
                      <div className="text-center text-gray-500 py-4">
                        추가 서비스 지역 정보가 없습니다.
                      </div>
                    )}
                  </div>
                </div>
              </div>

              <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div className="flex items-start">
                  <ExternalLink className="w-5 h-5 text-yellow-600 mr-3 mt-0.5" />
                  <div>
                    <p className="text-sm font-medium text-yellow-800 mb-1">서비스 지역 안내</p>
                    <p className="text-sm text-yellow-700">
                      기본 서비스 지역 외에도 서울 전 지역 출장 가능합니다.
                      거리에 따라 출장비가 추가되며, 정확한 비용은 견적 요청 시 안내해드립니다.
                    </p>
                  </div>
                </div>
              </div>
            </Card>
          </div>

          {/* Right Sidebar */}
          <div className="space-y-6">
            {/* Action Card */}
            <Card className="p-6 sticky top-8">
              <h3 className="text-xl font-semibold text-gray-900 mb-4">연락하기</h3>
              <div className="space-y-3">
                <Link href={`/request?expert=${expert.id}`}>
                  <Button className="w-full h-12 text-base bg-blue-600 hover:bg-blue-700">
                    <Phone className="w-5 h-5 mr-2" />
                    견적 요청하기
                  </Button>
                </Link>
                <Button variant="outline" className="w-full h-12 text-base" onClick={handleContact}>
                  <MessageSquare className="w-5 h-5 mr-2" />
                  채팅으로 문의
                </Button>
                <Button variant="outline" className="w-full h-12 text-base">
                  <Heart className="w-5 h-5 mr-2" />
                  관심 전문가 추가
                </Button>
              </div>

              <div className="mt-6 p-4 bg-green-50 rounded-lg border border-green-200">
                <div className="flex items-center gap-2 mb-2">
                  <Clock className="w-5 h-5 text-green-600" />
                  <span className="font-semibold text-green-800">빠른 응답</span>
                </div>
                <p className="text-sm text-green-700">
                  평균 {expert.response_time_hours}시간 내 응답합니다
                </p>
              </div>

              <div className="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <div className="text-center">
                  <p className="text-sm text-blue-800 font-medium">시간당 예상 비용</p>
                  <p className="text-2xl font-bold text-blue-900 mt-1">
                    {expert.hourly_rate?.toLocaleString()}원
                  </p>
                </div>
              </div>
            </Card>

            {/* Similar Experts */}
            <Card className="p-6">
              <h3 className="text-xl font-semibold text-gray-900 mb-4">유사한 전문가</h3>
              <div className="space-y-4">
                {expert.category?.[0] === '청소' && (
                  <Link href="/expert/550e8400-e29b-41d4-a716-446655440021">
                    <div className="flex items-center gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors cursor-pointer">
                      <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                        <Users className="w-6 h-6 text-green-600" />
                      </div>
                      <div className="flex-1">
                        <div className="font-medium text-gray-900">박깨끗</div>
                        <div className="text-sm text-gray-500 flex items-center gap-1">
                          <Star className="w-3 h-3 text-yellow-400 fill-current" />
                          <span>4.7</span>
                          <span>•</span>
                          <span>친환경 청소</span>
                        </div>
                      </div>
                      <Button variant="ghost" size="sm">
                        보기
                      </Button>
                    </div>
                  </Link>
                )}
                {expert.category?.[0] === '수리' && (
                  <Link href="/expert/550e8400-e29b-41d4-a716-446655440026">
                    <div className="flex items-center gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors cursor-pointer">
                      <div className="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                        <Users className="w-6 h-6 text-purple-600" />
                      </div>
                      <div className="flex-1">
                        <div className="font-medium text-gray-900">신가전</div>
                        <div className="text-sm text-gray-500 flex items-center gap-1">
                          <Star className="w-3 h-3 text-yellow-400 fill-current" />
                          <span>4.7</span>
                          <span>•</span>
                          <span>가전수리 전문</span>
                        </div>
                      </div>
                      <Button variant="ghost" size="sm">
                        보기
                      </Button>
                    </div>
                  </Link>
                )}
                {expert.category?.[0] === '과외' && (
                  <Link href="/expert/550e8400-e29b-41d4-a716-446655440027">
                    <div className="flex items-center gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors cursor-pointer">
                      <div className="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                        <Users className="w-6 h-6 text-blue-600" />
                      </div>
                      <div className="flex-1">
                        <div className="font-medium text-gray-900">김수학</div>
                        <div className="text-sm text-gray-500 flex items-center gap-1">
                          <Star className="w-3 h-3 text-yellow-400 fill-current" />
                          <span>4.8</span>
                          <span>•</span>
                          <span>이과 전문</span>
                        </div>
                      </div>
                      <Button variant="ghost" size="sm">
                        보기
                      </Button>
                    </div>
                  </Link>
                )}
                {expert.category?.[0] === '디자인' && (
                  <div className="text-center text-sm text-gray-500 py-4">
                    유사한 전문가가 없습니다
                  </div>
                )}
              </div>
            </Card>
          </div>
        </div>
      </div>
    </div>
  )
}